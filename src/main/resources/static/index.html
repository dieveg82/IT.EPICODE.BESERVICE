<!DOCTYPE html>
<html lang="it">

<head>
    <link rel="shortcut icon" href="">
    <title> Index BeService </title>

</head>

<body>
    <h1>
        Benvenuti nella pagina di BeSErvice <br>


    </h1>
    <h1>
        <p>
            Gestionale BeService<b> <br>
                <img src="BeService.jpg " alt="immagine non disponibile" />

    </h1>
    <h2>
        <form method="post" action="/indexcontroller/loginform">
            <fieldset>
                <legend>Login User </legend>
                <label for="username">username</label>
                <input name="username" th:field="*{username}">


                <label for="password">password</label>
                <input name="password" th:field="*{password}">

            </fieldset>

            <button name="invia" type="submit">Invia</button>
            <button name="annulla" type="button">Annulla </button>

        </form>

        <br>
        <br>
        <br>

        <form method="post" action="/indexcontroller/signupform">


            <fieldset>
                <legend>Signup User </legend>
                <label for="username">username</label>
                <input name="username">


                <label for="password">password</label>
                <input name="password">

                <label for="nome">nome</label>
                <input name="nome">

                <label for="cognome">cognome</label>
                <input name="cognome">

                <label for="email">email</label>
                <input name="email">
            </fieldset>

            <button name="invia" type="submit">Invia</button>
            <button name="annulla" type="button">Annulla </button>

        </form>
        <br>


        <fieldset>
            <legend> Cerca Fattura </legend>
            <label for="username">Numero Fattura</label>
            <input type="number" id="numeroFatturaFind">
        </fieldset>
        <button id="cercaFatturaButton"> Cerca</button>
        <button name="annulla" type="button">Annulla </button>
        <br />
        <br />

        <fieldset>
            <legend> Inserisci Fattura </legend>
            <label for="data">Data Fattura</label>
            <input type="datetime-local" id="dataFattura" name="inputFattura">
            <label for="numero">Numero Fattura</label>
            <input type="number" id="numeroFattura" name="inputFattura">
            <label for="anno">Anno</label>
            <input type="number" id="annoFattura" name="inputFattura">
            <label for="importo">Importo</label>
            <input type="number" id="importoFattura" name="inputFattura">
            <label for="partitaIva">Partita Iva Cliente</label>
            <input type="text" id="partitaIva" name="inputFattura">
        </fieldset>
        <button id="inserisciFattura"> Inserisci</button>
        <button name="annulla" type="button">Annulla </button>

    </h2>
    <button id="clicca"> clicca </button>

    <script type="text/javascript">

        // PRIMA FUNZIONE VEDI LISTA COMUNI
        document.getElementById("clicca").onclick = cambiaPagina;

        function cambiaPagina() {
            location.assign("reportComuni.html");
        }

        // SECONDA FUNZIONE CERCA PER ID CON VISUALIZZAZIONE FATTURA
        let buttonCercaFattura = document.getElementById("cercaFatturaButton");
        let inputNumeroFattura = document.getElementsByName("numeroFatturaFind");
        buttonCercaFattura.onclick = function (e) {
            if (inputNumeroFattura.value === "") {
                // questa funziona previene non fa inviare i dati della form se la condizione if Ã¨ rispettata ( ossia manca la
                // di un campo)
                e.preventDefault();
                alert(`non e' stato compilato un campo`);
            } else {
                sessionStorage.setItem("numeroFattura", inputNumeroFattura.value);
                location.assign("fattura.html")
                // cercaFattura(inputNumeroFattura.value);
            }
        };

        // TERZA FUNZIONE INSERIMENTO FATTURA
        let buttonInserisciFattura = document.getElementById("inserisciFattura");
        let inputFattura = document.getElementsByName("inputFattura");
       

         
        let cliente ="";
        buttonInserisciFattura.onclick = function (e) {
            if (inputFattura.value === "") {
                e.preventDefault();
                alert(`non e' stato compilato un campo`);
            } else {
                let connettore = new XMLHttpRequest();
                let partitaIva = document.getElementById("partitaIva");

                connettore.open("GET", "http://localhost:8080/controllercliente/findbypartitaiva?partitaIva=" + partitaIva.value, true);
                connettore.send();
                connettore.onreadystatechange = function () {
                    if (connettore.readyState === 4 && connettore.status === 200) {
                      cliente = JSON.parse (this.responseText);
                        data = document.getElementById("dataFattura").value;
                        data = data.slice(0,10);
                                               
                        let fattura = {
                            data: data,
                            numeroFattura: Number (document.getElementById("numeroFattura").value),
                            anno: Number( document.getElementById("annoFattura").value),
                            importo: Number (document.getElementById("importoFattura").value),
                            stato : {
                                id: 1,
                                nome: "Da pagare"
                            }
                        }
                        fattura.cliente = cliente;
                        fattura = JSON.stringify(fattura);
                        console.log (fattura);

                    }
                }
            }
        }
    </script>


</body>

</html>